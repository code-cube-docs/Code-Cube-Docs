
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../tag-inactivity/">
      
      
        <link rel="next" href="../consent-monitoring/">
      
      
      <link rel="icon" href="../../logo.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.18">
    
    
      
        <title>Offload raw data to your own BigQuery environment - Code Cube documentation library</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.66ac8b77.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
  <!-- Google Tag Manager -->
  <script>
    (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-K6VCS5W');
  </script>
  <!-- End Google Tag Manager -->

    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#manage-access-to-raw-tag-monitoring-data-in-bigquery" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Code Cube documentation library" class="md-header__button md-logo" aria-label="Code Cube documentation library" data-md-component="logo">
      
  <img src="../../code cube logo white.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Code Cube documentation library
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Offload raw data to your own BigQuery environment
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
    
  
  
    
    
      
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../error-monitoring-client-side/" class="md-tabs__link">
          
  
  Tag Monitor

        </a>
      </li>
    
  

    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../datalayer-guard/events-tag-manager/" class="md-tabs__link">
          
  
  DataLayer Guard

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Code Cube documentation library" class="md-nav__button md-logo" aria-label="Code Cube documentation library" data-md-component="logo">
      
  <img src="../../code cube logo white.png" alt="logo">

    </a>
    Code Cube documentation library
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" checked>
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Tag Monitor
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            Tag Monitor
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_1" >
        
          
          <label class="md-nav__link" for="__nav_1_1" id="__nav_1_1_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Installing the Tag Monitor
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_1">
            <span class="md-nav__icon md-icon"></span>
            Installing the Tag Monitor
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../error-monitoring-client-side/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Client-side set-up
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../error-monitoring-server-side/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Server-side set-up
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tag-bulk-edit/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Bulk editing your tags in GTM
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_2" checked>
        
          
          <label class="md-nav__link" for="__nav_1_2" id="__nav_1_2_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Using the Tag Monitor
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_1_2">
            <span class="md-nav__icon md-icon"></span>
            Using the Tag Monitor
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tag-inactivity/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Enabling Tag Inactivity
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Offload raw data to your own BigQuery environment
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Offload raw data to your own BigQuery environment
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#granting-access-to-raw-tag-monitoring-data" class="md-nav__link">
    <span class="md-ellipsis">
      Granting access to raw Tag Monitoring data
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Granting access to raw Tag Monitoring data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creating-a-service-account-for-code-cube" class="md-nav__link">
    <span class="md-ellipsis">
      Creating a Service Account for Code Cube
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preparing-the-bigquery-datasets-and-tables" class="md-nav__link">
    <span class="md-ellipsis">
      Preparing the BigQuery datasets and tables
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Preparing the BigQuery datasets and tables">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-the-bigquery-dataset" class="md-nav__link">
    <span class="md-ellipsis">
      Create the BigQuery dataset
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-the-bigquery-table-for-client-side-monitoring" class="md-nav__link">
    <span class="md-ellipsis">
      Create the BigQuery table for client-side monitoring
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-the-table-for-server-side-monitoring" class="md-nav__link">
    <span class="md-ellipsis">
      Create the table for server-side monitoring
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-the-client-and-server-side-queries" class="md-nav__link">
    <span class="md-ellipsis">
      Creating the client- and server-side queries
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Creating the client- and server-side queries">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#client-side-data" class="md-nav__link">
    <span class="md-ellipsis">
      Client-side data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#server-side-data" class="md-nav__link">
    <span class="md-ellipsis">
      Server-side data
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-the-scheduled-query-in-your-bigquery-environment" class="md-nav__link">
    <span class="md-ellipsis">
      Create the scheduled query in your BigQuery environment
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../consent-monitoring/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Consent Monitoring
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../serverside-error-logging/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Server-side error logging
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    DataLayer Guard
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            DataLayer Guard
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../datalayer-guard/events-tag-manager/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Monitoring events via Tag Management
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#granting-access-to-raw-tag-monitoring-data" class="md-nav__link">
    <span class="md-ellipsis">
      Granting access to raw Tag Monitoring data
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Granting access to raw Tag Monitoring data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creating-a-service-account-for-code-cube" class="md-nav__link">
    <span class="md-ellipsis">
      Creating a Service Account for Code Cube
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preparing-the-bigquery-datasets-and-tables" class="md-nav__link">
    <span class="md-ellipsis">
      Preparing the BigQuery datasets and tables
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Preparing the BigQuery datasets and tables">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-the-bigquery-dataset" class="md-nav__link">
    <span class="md-ellipsis">
      Create the BigQuery dataset
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-the-bigquery-table-for-client-side-monitoring" class="md-nav__link">
    <span class="md-ellipsis">
      Create the BigQuery table for client-side monitoring
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-the-table-for-server-side-monitoring" class="md-nav__link">
    <span class="md-ellipsis">
      Create the table for server-side monitoring
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-the-client-and-server-side-queries" class="md-nav__link">
    <span class="md-ellipsis">
      Creating the client- and server-side queries
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Creating the client- and server-side queries">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#client-side-data" class="md-nav__link">
    <span class="md-ellipsis">
      Client-side data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#server-side-data" class="md-nav__link">
    <span class="md-ellipsis">
      Server-side data
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-the-scheduled-query-in-your-bigquery-environment" class="md-nav__link">
    <span class="md-ellipsis">
      Create the scheduled query in your BigQuery environment
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="manage-access-to-raw-tag-monitoring-data-in-bigquery">Manage access to raw Tag Monitoring data in BigQuery</h1>
<p>To offload BigQuery data from one project to another, we'll create a scheduled query managed by a service account.</p>
<div class="alert alert-info" role="alert">
This feature is only available in the <b> premium package </b>
</div>

<h2 id="granting-access-to-raw-tag-monitoring-data">Granting access to raw Tag Monitoring data</h2>
<p>This section explains how to set up access control for offloading BigQuery data using a service account. A service account is a special Google Cloud identity used by applications or services to access Google Cloud resources.</p>
<h3 id="creating-a-service-account-for-code-cube">Creating a Service Account for Code Cube</h3>
<ol>
<li><strong>Navigate to the Service Account Creation Page</strong>: In the Google Cloud Console, locate the "IAM &amp; Admin" section and navigate to the "Service Accounts" page. Alternatively, you can directly access the service account creation page using [this link] (https://cloud.google.com/iam/docs/service-account-overview).</li>
<li><strong>Select your Google Cloud Project</strong>: From the dropdown menu, ensure you've selected the project containing the BigQuery dataset you want to share with Code Cube.</li>
<li><strong>Create a Service Account with a Descriptive Name</strong>:  Enter a clear and descriptive name for the service account. This name helps identify the purpose of the account (e.g., "codecube-tagmonitor-access"). The Google Cloud Console will generate a unique service account ID based on this name. You can edit the ID if needed, but keep in mind that it cannot be changed later.</li>
<li><strong>Assign the </strong>BigQuery User<strong> IAM role</strong>: Grant the service account the "BigQuery User" role. This role provides the necessary permissions to access and query BigQuery data.</li>
<li><strong>Finalize Service Account Creation</strong>: Click the "Done" button to create the service account.</li>
</ol>
<p><strong>Important Note</strong>: After creating the service account, you'll need to share the service account ID securely with your contact at Code Cube. This ID will be used by Code Cube to establish access to your BigQuery data through the scheduled query. Remember to restrict access to the service account after granting access to Code Cube. You can manage access controls later by following the instructions in the Google Cloud documentation https://cloud.google.com/iam/docs/understanding-roles.</p>
<h2 id="preparing-the-bigquery-datasets-and-tables">Preparing the BigQuery datasets and tables</h2>
<p>This section guides you through creating the BigQuery datasets and tables that will store your offloaded Tag Monitoring data.</p>
<h3 id="create-the-bigquery-dataset">Create the BigQuery dataset</summary></h3>
<p>A BigQuery dataset is a container that organizes your tables. Here's how to create a new dataset for Code Cube's Tag Monitoring data:</p>
<ol>
<li><strong>Open the BigQuery console</strong>: In the Google Cloud Console, navigate to the BigQuery service.2. In the Explorer panel, select the project where you want to create the dataset.</li>
<li><strong>Select your project</strong>: In the BigQuery console's left-hand navigation panel, locate the "Explorer" section.  Ensure you have selected the GCP project where you want to store the Tag Monitoring data.</li>
<li><strong>Create a new dataset</strong>:  Within the "Explorer" panel, click the "Actions" dropdown menu and choose "Create dataset".</li>
<li><strong>Name your dataset</strong>: Enter a unique and descriptive name for the dataset. A good example might be "codecube-tagmonitor". This name helps identify the purpose of the dataset.</li>
<li><strong>Set the location</strong>:  BigQuery allows you to choose where your data is geographically stored. For this case, select "multi-region" and "EU" as the location type.</li>
<li><strong>Create the dataset</strong>: Once you've filled in the details, click the "Create dataset" button to create the new dataset in BigQuery.</li>
</ol>
<h3 id="create-the-bigquery-table-for-client-side-monitoring">Create the BigQuery table for client-side monitoring</h3>
<ol>
<li><strong>Select the new dataset and click 'Create table'</strong>: In the BigQuery console, navigate to your newly created dataset and click the "Create table" button.</li>
<li><strong>Choose 'Empty table' as the table type</strong>: Select "Empty table" to create a new table without referencing existing data.</li>
<li><strong>Provide a descriptive table name</strong>: Enter a clear and descriptive name for the table, such as 'raw_data_client'. </li>
<li>
<p><strong>Define the table schema as follows</strong>: The table schema defines the structure and data types for each column. Here's a breakdown of the columns used to store client-side monitoring data:    </p>
<pre><code>| Field name        | Type          | Mode |
| ----------------- | ------------- | --------
| timestamp         | TIMESTAMP     |NULLABLE
| initial_url       | STRING        | NULLABLE
| url               | STRING        | NULLABLE
| event_name        | STRING        | NULLABLE
| event_timestamp   | STRING        | NULLABLE
| container_version | STRING        | NULLABLE
| container_id      | STRING        | NULLABLE
| env_name          | STRING        | NULLABLE
| tag               | RECORD        | REPEATED
| id                | STRING        | NULLABLE
| name              | STRING        | NULLABLE
| status            | STRING        | NULLABLE
| channel           | STRING        | NULLABLE
| execution_time    | STRING        | NULLABLE
</code></pre>
</li>
<li>
<p><strong>Select 'No partitioning' for this table</strong>: Partitioning is not required at this moment.</p>
</li>
<li><strong>Click Create table</strong>: Once you've filled in the details, click the "Create table" button to create the table in BigQuery.</li>
</ol>
<h3 id="create-the-table-for-server-side-monitoring">Create the table for server-side monitoring</summary></h3>
<ol>
<li><strong>Select the new dataset and click 'Create table'</strong>: In the BigQuery console, navigate to your newly created dataset and click the "Create table" button.2. Choose 'Empty table' as the table type.</li>
<li><strong>Choose 'Empty table' as the table type</strong>: Select "Empty table" to create a new table without referencing existing data.</li>
<li><strong>Provide a descriptive table name</strong>: Enter a clear and descriptive name for the table, such as 'raw_data_server'. </li>
<li>
<p><strong>Define the table schema as follows</strong>: The table schema defines the structure and data types for each column. Here's a breakdown of the columns used to store server-side monitoring data:    </p>
<pre><code>| Field name        | Type      | Mode |
| ----------------- | --------- | --------
| timestamp         | TIMESTAMP | NULLABLE
| url               | STRING    | NULLABLE
| event_name        | STRING    | NULLABLE
| event_timestamp   | INTEGER   | NULLABLE
| client_name       | STRING    | NULLABLE
| container_version | STRING    | NULLABLE
| container_id      | STRING    | NULLABLE
| env_name          | STRING    | NULLABLE
| tag               | RECORD    | REPEATED
| id                | STRING    | NULLABLE
| name              | STRING    | NULLABLE
| status            | STRING    | NULLABLE
| execution_time    | STRING    | NULLABLE
</code></pre>
</li>
<li>
<p><strong>Select 'No partitioning' for this table</strong>: Partitioning is not required at this moment.</p>
</li>
<li><strong>Click Create table</strong>: Once you've filled in the details, click the "Create table" button to create the table in BigQuery.</li>
</ol>
<h3 id="creating-the-client-and-server-side-queries">Creating the client- and server-side queries</summary></h3>
<p>This section explains how to write queries to extract client-side and server-side data from your BigQuery tables. These queries will be used later to set up scheduled data offloading to Code Cube.</p>
<h4 id="client-side-data">Client-side data</h4>
<p>The following SQL query retrieves all data from Code Cube's raw_data_client table for the previous day:</p>
<pre><code class="language-sql">SELECT * FROM `code-cube.{{dataset_name}}.raw_data_client`
WHERE DATE(timestamp) = DATE(DATE_ADD(CURRENT_TIMESTAMP(), INTERVAL -1 DAY))
</code></pre>
<p>** Explanation:**</p>
<ul>
<li>SELECT *: This selects all columns from the table.</li>
<li>FROM: This clause specifies the source table, which is code-cube.{{dataset_name}}.raw_data_client.</li>
<li>Replace {{dataset_name}} with the actual name of the dataset. The dataset name can be found in the portal under <strong>client-side error monitoring settings</strong> on the Tag Monitor configuration page.</li>
<li>WHERE: This clause filters the results to include only data where the timestamp field falls on the previous day relative to the current time.</li>
<li>DATE(timestamp): Extracts the date portion from the timestamp field.</li>
<li>DATE(DATE_ADD(CURRENT_TIMESTAMP(), INTERVAL -1 DAY)): Calculates the date for one day before the current timestamp.</li>
</ul>
<p>Note: You can modify this query to filter data for a specific date range or based on other criteria.</p>
<h4 id="server-side-data">Server-side data</h4>
<p>The query for server-side data retrieval is similar to the client-side query, but uses the raw_data_server table instead. Simply replace "client" with "server" throughout the query:</p>
<pre><code class="language-sql">SELECT * FROM `code-cube.{{dataset_name}}.raw_data_server`
WHERE DATE(timestamp) = DATE(DATE_ADD(CURRENT_TIMESTAMP(), INTERVAL -1 DAY))
</code></pre>
<p>The {{dataset}} name is equal to the dataset name shown on the Tag Monitor configuration page.</p>
<h3 id="create-the-scheduled-query-in-your-bigquery-environment">Create the scheduled query in your BigQuery environment</h3>
<p>The next step involves creating scheduled queries in your BigQuery environment to automate this data retrieval process. This will ensure regular data offloading to Code Cube.</p>
<p><strong>1. Provide details and schedule for the query (once a day)</strong></p>
<ul>
<li>In the BigQuery console, navigate to the query editor.</li>
<li>Paste your client-side or server-side query (refer to the previous section) into the editor window.</li>
<li>Locate the "Schedule" section. This section allows you to define how often the query should run.</li>
<li>Set the "Frequency" to "Daily".</li>
<li>Optionally, you can define a specific time for the query to run each day.</li>
</ul>
<p><strong>2. Add destination details for query results.</strong>
In the "Destination" section, BigQuery offers various options for where to store the query results. Select here the tables created in the previous steps.</p>
<p><strong>3. Add the service account</strong></p>
<ul>
<li>In the "Job configuration" section, locate the "Service account" option.</li>
<li>Select the service account you created and granted access to your BigQuery data.</li>
</ul>
<p><strong>4. Save the settings</strong></p>
<ul>
<li>Once you've filled in all the details, review your query and configurations.</li>
<li>Click the "Save" button to create and schedule the query.</li>
</ul>
<p>Additional Notes:</p>
<ul>
<li>BigQuery allows you to preview the query results before saving the scheduled query. This can help ensure the query retrieves the expected data.</li>
<li>Consider naming your scheduled queries descriptively to improve clarity and organization within your BigQuery environment.</li>
</ul>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.top", "navigation.path", "navigation.sections", "navigation.tabs"], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.3220b9d7.min.js"></script>
      
    
  </body>
</html>